@model PDMSCore.BusinessObjects.Project

@using PDMSCore.HtmlHelpers
@{
    ViewBag.Title = "Index";
}



@*<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>*@

<script src="~/js/jquery-1.10.2.js"></script>
<script type="text/javascript">

    function MonkeyPatchAutocomplete() {
        // Musi byt zde a ne v site.js.
        // https://stackoverflow.com/questions/2435964/how-can-i-custom-format-the-autocomplete-plug-in-results
        // Don't really need to save the old fn,
        // but I could chain if I wanted to
        var oldFn = $.ui.autocomplete.prototype._renderItem;
        $.ui.autocomplete.prototype._renderItem = function (ul, item) {
            var re = new RegExp("^" + this.term, "i");
            var t = item.label.replace(re, "<span style='font-weight:bold;'>" + this.term + "</span>");
            return $("<li></li>")
                .data("item.autocomplete", item)
                .append("<a>" + t + "</a>")
                .appendTo(ul);
        };
    }
    function Autocomplete() {
        // Musi byt zde a ne v site.js.
        $(".AutoComplete").autocomplete({
            minLength: 1,
            autoFocus: true,
            source: function (request, response) {
                $.ajax({
                    url: "/Project/AjaxAutoComplete/",
                    type: "POST",
                    highlightPhrase: false,
                    dataType: "json",
                    data: { prefix: request.term, id: $(this.element).prop("id") },
                    success: function (data) {
                        response($.map(data, function (item) {
                            // properties "item" musi zacinat malym pismenem !!!
                            // A pokud se do "value" dam hodnotu (jako "item.id"),
                            // tak se pri submitu posle na server pouze tato hodnota (id) a ne ten text v item.suggestion.
                            return { label: item.suggestion/*, value: item.id */ };
                        }))
                    }
                })
            },
            messages: {
                noResults: "", results: ""
            }
        });
    }

    //function getFromController(url, name, model) {
    //    alert("separe async");
    //    var obj = $(‘#’ + name);
    //    ajaxCall(url, obj, model, ‘GET’);
    //}


    $(document).ready(function () {
        MonkeyPatchAutocomplete();
        Autocomplete();

        function ajaxCall(url, obj, model, verb) {
            $.ajax({
                cache: false,
                type: verb,
                url: url,
                data: model,
                beforeSend: function () {
                    obj.addClass(window.async.disabledClass);
                },
                success: function (data) {
                    obj.replaceWith(data);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    //log this information or show it…
                    obj.replaceWith(xhr.responseText);
                },
                complete: function () {
                    obj.removeClass(window.async.disabledClass);
                    updateURL(url, model, verb);
                }

            });

        }

        //function updateURL(action, model, verb) {
        //    if (history.pushState) {
        //        var split = action.split("/");
        //        split[split.length – 1] = split[split.length – 1].replace("Async", ”);
        //        action = split.join("/");
        //        if (model != null && verb != "POST")
        //            action = action + "?" + $.param(model);
        //        var newurl = window.location.protocol + "//" + window.location.host;
        //        newurl = newurl + action;
        //        window.history.pushState({ path: newurl }, ”, newurl);
        //    }

        //}

        @*$("#PartialViewWraper").change(function () {
            var categoryId =  $("#ddlCategory").val();
               $("#dvCategoryResults").load('@(Url.Action("GetCategoryProducts","Home",null, Request.Url.Scheme))?categoryId=' + categoryId);
        });*@
    })

</script>

<div class="Content">
    @for (int i = 0; i < Model.PanelList.Count; i++)
    {
        <div class="Panel @Model.PanelList[i].Size">
            <div class="Panel-Header">

                <div class="Panel-Header-Left">
                    @Model.PanelList[i].Label
                </div>

                <div class="Panel-Header-Right">
                    @Model.PanelList[i].menu.HtmlText()
                </div>

            </div>
            <div class="Panel-Body">
                <form method="post">
                    <input name="PanelId" hidden type="text" value="@Model.PanelList[i].id " />
                    @for (int f = 0; f < Model.PanelList[i].Content.Count; f++)
                    {
                        @MSHelpers.Field(Model.PanelList[i].Content[f]);
                    }
                    <input type="submit">
                </form>
            </div>
        </div>


        @*<div>
                <form method="post">
                    <input class="AutoComplete" type="text" id="id1" name="jmeno1" placeholder="ph1" label="MujLabel1" />
                    <input class="AutoComplete" type="text" id="id2" name="jmeno2" placeholder="ph2" label="MujLabel2" />
                    <input class="AutoComplete" type="text" id="id3" name="jmeno3" placeholder="ph3" label="MujLabel3" />
                    <input type="submit">
                </form>
            </div>*@
    }


    <div class="Panel x1">
        <div class="Panel-Header">
            <div class="Panel-Header-Left">GetRandom</div>
            <div class="Panel-Header-Right">
                <div class="dd-menu"><i aria-hidden="true" class="fa fa-gear dd-menu-btn" onclick="onPanelMenuClick('PanelMenu3')"></i><div class="dd-menu-content" id="PanelMenu3"><a href="www0.cz">0</a><a href="www1.cz">1</a><a href="www2.cz">2</a><a href="www3.cz">3</a><a href="www4.cz">4</a></div></div>
            </div>
        </div>
        <div class="Panel-Body">
            <div id="list" class="loader">
                <a>test</a>
                <hr />

                zacatek
                <div id="#PartialViewWrapperHovno">
                    #PartialViewWrapperHovno
                </div>
                
                <br/>

                <div id="#PartialViewWrapper3">

                    @(Url.Action("Internet", "Project"))

                    @*@Html.Partial("AsyncShowProjects")*@
                    <script type="text/javascript">

                        
                        //jQuery("#PartialViewWrapperHovno").load("http://examplepage.com/forum/showthread.php?tid=NN#pid_NN");

                        $("#PartialViewWrapperHovno").load('/Project/ShowProject');

                        alert("PartialViewWrapper3");

                        //$("PartialViewWrapperHovno").load('/Project/Internet');

                        //alert("#PartialViewWrapper3");
                    </script>

                </div>
                konec

                <div id=”list” class=”loader”>

                    @*Funguje*@
                    @*                    @Html.Partial("AsyncShowProjects");*@

                    @*<script>

                        getFromController(null, null, null);

                        var url = "~/Controllers/ProjectController";
                        var name = "AsyncShowProjects";
                        var model = null;

                        var obj = $("#" + name);
                        ajaxCall(url, obj, model, "GET");

                        $(document).ready(function () {
                            //window.async.getFromController(‘/Async/AsyncList’, ‘list’, null);
                            //window.async.getFromController('/AsyncShowProjects', 'AsyncShowProjects', null);
                        });
                    </script>*@

                </div>


                @*@Model.AsyncPanelList()*@
                @*@AsyncLoader.Render(“Async”, “AsyncEdit”, “list”, new { Id = Model })*@

            </div>
        </div>
    </div>



</div>



@section SideMenu
    {

    @Model.SideMenu.HtmlText()
}